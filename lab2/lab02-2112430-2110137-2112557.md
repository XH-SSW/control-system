# 实验报告lab2
## 小组成员：2112430 薛浩，2110137 林楷达，2112557 石轹文


#### 练习一·理解first-fit 连续物理内存分配算法
* first-fit 连续物理内存分配算法作为物理内存分配一个很基础的方法，需要同学们理解它的实现过程。请大家仔细阅读实验手册的教程并结合kern/mm/default_pmm.c中的相关代码，认真分析default_init，default_init_memmap，default_alloc_pages， default_free_pages等相关函数，并描述程序在进行物理内存分配的过程以及各个函数的作用。 请在实验报告中简要说明你的设计实现过程。请回答如下问题：你的first fit算法是否有进一步的改进空间？
** 1.default_init：初始化链表结构体free_list,并将nr_free赋值为0，其中free_list用于记录空闲内存块。nr_free是空闲内存块的总数；
** 2.default_init_memmap：该函数的作用是初始化一个内存映射，将一系列页（page）设置为空闲状态，并将它们添加到空闲页链表中。函数接收两个参数：一个指向页结构体的指针数组（base）和数组的长度（n）。
** 3.default_alloc_pages：该函数用于从空闲页列表`free_list`中分配`n`个连续的页。
** 4.default_free_pages：将页面重新链接到空闲列表中，可能将小的空闲块合并为大的空闲块。
** 5.default_nr_free_pages：返回空闲页面的数目
** 6.basic_check：进行页面分配和释放的功能检查，确保这些功能的正确性。
** 7.default_check：检查first-fit 连续物理内存分配算法能否正常进行。
** 8.first fit的进一步改进的空间：可以用best fit算法，其选择最适合当前任务需求的资源，从而避免浪费资源；还会考虑当前系统的负载情况以及其他任务的资源需求，这样可以避免任务因为资源不足而无法及时响应；同时可以动态地调整任务的资源需求，以适应系统变化。

#### 练习二·实现 Best-Fit 连续物理内存分配算法
* 在完成练习一后，参考kern/mm/default_pmm.c对First Fit算法的实现，编程实现Best Fit页面分配算法，算法的时空复杂度不做要求，能通过测试即可。 请在实验报告中简要说明你的设计实现过程，阐述代码是如何对物理内存进行分配和释放，并回答如下问题：你的 Best-Fit 算法是否有进一步的改进空间？

```
while ((le = list_next(le)) != &free_list) {
        struct Page *p = le2page(le, page_link);
        if (p->property >= n && p->property<min_size) {
            page = p;
            min_size=p->property;
        }
    }
    if (page != NULL) {
        list_entry_t* prev = list_prev(&(page->page_link));
        list_del(&(page->page_link));
        if (page->property > n) {
            struct Page *p = page + n;
            p->property = page->property - n;
            SetPageProperty(p);
            list_add(prev, &(p->page_link));
        }
        nr_free -= n;
        ClearPageProperty(page);
    }
    return page;
}


```
* 
** 1.进行best fit更改的部分如上，遍历链表 free_list，查找满足条件的连续物理页。条件是物理页的属性（property）大于等于所需的最大属性（n）且小于最小属性（min_size）。如果找到满足条件的物理页，将其保存在变量 page 中，并更新最小属性（min_size）。如果找到了满足条件的物理页（page != NULL），就会获取 page 对应的链表节点的前一个节点（prev），并从链表中删除 page 节点，随后判断 page 的属性是否大于所需的最大属性（n），如果满足条件，就会创建一个新的物理页（p），它位于 page 之后，属性为 page 的属性减去最大属性（n），更新新物理页的属性（p->property）并调用 SetPageProperty() 函数，然后将新物理页添加到 prev 节点之后。之后更新已分配的物理页数量（nr_free），减去最大属性（n），并将page的属性清零，返回满足条件的页面。
** 2.改进方法：
** （1）交叉操作：可以使用单点交叉、多点交叉或均匀交叉等方法。
** （2）变异操作：可以使用随机变异、均匀变异或其他变异方法。
** （3）参数调整：可以调整选择概率、交叉率、变异率等参数，以优化算法的性能。



### 知识点：
* 
** 1.First-fit 连续物理内存分配算法是一种内存分配策略，它从内存池中分配连续的物理内存块，以满足进程的内存需求。该算法的基本思想是，在内存池中找到一个足够大且不与任何其他已分配内存块重叠的内存块，将其分配给进程。
** 2.assert 语句通常用于调试程序，帮助程序员快速发现代码中的错误。在实际应用中，assert 语句通常用于检查程序的输入和关键路径上的条件，以确保程序能够正确地执行。
** 3.通常情况下，操作系统会使用页面置换算法来管理内存中的页面，将不再使用的页面换出到磁盘上，以便为新的页面腾出空间。但是，有些页面可能需要一直保留在内存中，以便快速访问。这些页面可以通过 PageReserved() 函数来标记为保留状态，防止它们被换出到磁盘上。需要注意的是，PageReserved() 函数只是标记页面为保留状态，并不保证页面一定会一直留在内存中。如果内存资源不足，操作系统仍然可能会选择将保留页面换出到磁盘上，以便为新的页面腾出空间。
** 4.虚拟内存是计算机系统内存管理的一种技术，它允许程序访问的内存空间大于实际可用的物理内存。通过将一部分内存页面交换到磁盘上，虚拟内存可以提供比实际物理内存更大的内存空间。
** 5.页面的属性包括页面的地址、大小、状态等，而空闲内存块的数量则是指操作系统中可用的未分配的内存块的数量。虽然页面和内存块有一定的关联性，但它们并不一定相等。在某些情况下，一个页面可能被映射到多个内存块上，而在另一些情况下，多个页面可能被映射到同一个内存块上。因此，页面的属性和空闲内存块的数量并没有必然的联系。
** 6.Best Fit 算法的基本思想是：对于每一个约束条件，找到一个最佳解，使得该解在该约束条件下与目标函数的距离最小。然后，选择所有约束条件下的最佳解中的最优者作为最终解。在 Best Fit 算法中，通常使用一种启发式函数来近似计算每个约束条件下的最佳解，并使用贪心策略来选择最终解。该算法通常需要多次迭代，直到找到一个满足所有约束条件的解或者达到预定的停止条件。
** 7.内存池是一种预先分配大块内存的方法，以避免在程序运行过程中频繁地分配和释放小块内存，从而提高性能和稳定性。